<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý Phiếu Nhập Hàng</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f8fafc;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 1100px;
    margin: auto;
    padding: 30px;
}

h2 {
    margin-top: 30px;
    margin-bottom: 15px;
}

input, button {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
}

button {
    cursor: pointer;
}

button.save { background: #4CAF50; color: white; }
button.cancel { background: #ccc; }
button.edit { background: #0a84ff; color: white; }
button.delete { background: #d9534f; color: white; }

/*bang chinh*/
.table-container {
    background: #D8EBEA;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px; 

}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    border-bottom: 1px solid black;
    text-align: center;
    padding: 10px;
}

/* Các dòng sản phẩm */
.product-row {
    display: flex;
    gap: 12px;
    margin-bottom: 10px;
}

.product-row input {
    flex: 1;
}

/*Them khoang cach giua cac o*/
#addProductContainer,
#editProductContainer {
    margin-top: 15px;
}

.btn-add-product {
    background: #0a84ff;
    color: white;
    border: none;
    margin-top: 12px;
}
</style>
</head>
<body>

<div class="container">

    <h2>Danh sách Phiếu nhập hàng</h2>
    <input type="text" id="searchInput" placeholder="Tìm theo ID / tên sản phẩm / ngày..." style="width: 50%; margin-bottom: 12px" oninput="searchInvoice()">

    <div class="table-container">
        <table id="invoiceTable">
            <thead>
                <tr>
                    <th>ID Phiếu</th>
                    <th>Sản phẩm</th>
                    <th>Ngày nhập</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Form thêm -->
    <h2>Thêm Phiếu nhập hàng</h2>
    <div>
        <input id="addId" placeholder="ID phiếu">
        <input id="addDate" type="date">
        <div id="addProductContainer"></div>

        <button class="btn-add-product" onclick="addProductRow('addProductContainer')">+ Thêm sản phẩm</button>
        <br><br>
        <button class="save" onclick="saveInvoice()">Lưu phiếu nhập</button>
    </div>

    <!-- Form sửa -->
    <h2>Chỉnh sửa Phiếu nhập hàng</h2>
    <div>
        <input id="editId" disabled>
        <input id="editDate" type="date">
        <div id="editProductContainer"></div>

        <button class="btn-add-product" onclick="addProductRow('editProductContainer')">+ Thêm sản phẩm</button>
        <br><br>
        <button class="cancel" onclick="cancelEdit()">Hủy</button>
        <button class="save" onclick="updateInvoice()">Lưu thay đổi</button>
    </div>

</div>
<script>
let invoices = [];
let editingIndex = null;
/*Thêm một dòng sản phẩm với các giá trị giá và số lượng*/
function addProductRow(containerId) {
    const container = document.getElementById(containerId);
    const row = document.createElement("div");
    row.className = "product-row";
    row.innerHTML = `
        <input placeholder="Tên sản phẩm">
        <input placeholder="Giá" type="number">
        <input placeholder="Số lượng" type="number">
    `;
    container.appendChild(row);
}
/*lưu 1 phiếu mới vào mảng */
function saveInvoice() {
    let id = document.getElementById("addId").value.trim();
    let date = document.getElementById("addDate").value;
    let products = [...document.querySelectorAll("#addProductContainer .product-row")].map(r => {
        let i = r.querySelectorAll("input");
        return { name: i[0].value, price: i[1].value, qty: i[2].value };
    });
    invoices.push({ id, date, products });
    renderTable();
    document.getElementById("addId").value = "";
    document.getElementById("addDate").value = "";
    document.getElementById("addProductContainer").innerHTML = "";
}
/*Có thêm 1 phiếu thì điều chỉnh lại bảng*/
function renderTable() {
    let tbody = document.querySelector("#invoiceTable tbody");
    tbody.innerHTML = "";
    invoices.forEach((invoice, index) => {
        invoice.products.forEach((p, i) => {
            tbody.innerHTML += `
            <tr>
                <td>${i === 0 ? invoice.id : ""}</td>
                <td>${p.name}</td>
                <td>${invoice.date}</td>
                <td>${p.price}</td>
                <td>${p.qty}</td>
                ${i === 0 ? `
                <td>
                    <button class="edit" onclick="editInvoice(${index})">Sửa</button>
                    <button class="delete" onclick="deleteInvoice(${index})">Xóa</button>
                </td>` : `<td></td>`}
            </tr>`;
        });
    });
}

/*nạp dữ liệu vào mục chỉnh sửa */
function editInvoice(index) {
    editingIndex = index;
    let inv = invoices[index];
    document.getElementById("editId").value = inv.id;
    document.getElementById("editDate").value = inv.date;
    document.getElementById("editProductContainer").innerHTML = "";
    inv.products.forEach(p => {
        addProductRow("editProductContainer");
        let inputs = document.querySelectorAll("#editProductContainer .product-row:last-child input");
        inputs[0].value = p.name;
        inputs[1].value = p.price;
        inputs[2].value = p.qty;
    });

    document.querySelector("h2:nth-of-type(3)").scrollIntoView({ behavior: "smooth" });
}
/*Cập nhật chỉnh sửa vào phiếu*/
function updateInvoice() {
    let date = document.getElementById("editDate").value;
    let products = [...document.querySelectorAll("#editProductContainer .product-row")].map(r => {
        let i = r.querySelectorAll("input");
        return { name: i[0].value, price: i[1].value, qty: i[2].value };
    });
    invoices[editingIndex].date = date;
    invoices[editingIndex].products = products;
    renderTable();
}

function cancelEdit(){
    document.getElementById("editProductContainer").innerHTML = "";
}
/*Lọc và hiển thị mục phù hợp*/
function searchInvoice() {
    let query = document.getElementById("searchInput").value.toLowerCase();
    let tbody = document.querySelector("#invoiceTable tbody");
    tbody.innerHTML = "";

    invoices.forEach((invoice, index) => {
        const match = invoice.id.toLowerCase().includes(query) ||
                      invoice.date.toLowerCase().includes(query) ||
                      invoice.products.some(p => p.name.toLowerCase().includes(query));

        if (match) {
            invoice.products.forEach((p, i) => {
                tbody.innerHTML += `
                <tr>
                    <td>${i === 0 ? invoice.id : ""}</td>
                    <td>${p.name}</td>
                    <td>${invoice.date}</td>
                    <td>${p.price}</td>
                    <td>${p.qty}</td>
                    ${i === 0 ? `
                    <td>
                        <button class="edit" onclick="editInvoice(${index})">Sửa</button>
                        <button class="delete" onclick="deleteInvoice(${index})">Xóa</button>
                    </td>` : `<td></td>`}
                </tr>`;
            });
        }
    });
}
</script>
</body>
</html>
