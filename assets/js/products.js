// database/products.js

const products = window.globalJsonData = {
  "product": {
    "brand": [
      {
        "name": "laptop",
        "status": "active",
        "laptop": [
          {
            "id": "AC-AS5-i5-R2UP",
            "model": "Laptop Acer Gaming Nitro V ANV15-41-R2UP",
            "price": "16.390.000",
            "status": "an",
            "image": "../assets/images/Acer1.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-i5-R0FE",
            "model": "Laptop Gaming Acer Nitro V 15 ProPanel ANV15-41-R0FE",
            "price": "21.990.000",
            "status": "hien",
            "image": "../assets/images/Acer2.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"2"
          },
          {
            "id": "AC-AS5-i5-R7CR",
            "model": "Laptop gaming Acer Nitro V 15 ProPanel ANV15 41 R7CR",
            "price": "24.490.000",
            "status": "hien",
            "image": "../assets/images/Acer3.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-R0Y4",
            "model": "Laptop gaming Acer Nitro V 15 ProPanel ANV15 41 R0Y4",
            "price": "24.990.000",
            "status": "hien",
            "image": "../assets/images/Acer4.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-R5F4",
            "model": "Laptop Gaming Acer Nitro 16 AI ProPanel AN16S 61 R5F4",
            "price": "39.990.000",
            "status": "hien",
            "image": "../assets/images/Acer5.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-56WQ",
            "model": "Laptop Gaming Acer Nitro Lite 16 NL16 71G 56WQ",
            "price": "19.990.000",
            "status": "hien",
            "image": "../assets/images/Acer6.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-78BG",
            "model": "Laptop gaming Acer Nitro V ANV15 51 78BG",
            "price": "29.590.000",
            "status": "hien",
            "image": "../assets/images/Acer7.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AP-93P0",
            "model": "Laptop Gaming Acer Predator Helios 18 PH18 73 93P0",
            "price": "97.990.000",
            "status": "hien",
            "image": "../assets/images/Acer8.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AP-757W",
            "model": "Laptop Gaming Acer Predator Helios Neo 16 AI PHN16 73 757W",
            "price": "50.890.000",
            "status": "hien",
            "image": "../assets/images/Acer9.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-59AA",
            "model": "Laptop gaming Acer Nitro V ProPanel ANV15 52 59AA",
            "price": "26.990.000",
            "status": "hien",
            "image": "../assets/images/Acer10.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-R9M1",
            "model": "Laptop Gaming Acer Nitro V ANV15 41 R9M1",
            "price": "19.990.000",
            "status": "hien",
            "image": "../assets/images/Acer11.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"30"
          },
          {
            "id": "AC-AS5-500A",
            "model": "Laptop Gaming Acer Nitro V 15 ANV15 51 500A",
            "price": "19.290.000",
            "status": "hien",
            "image": "../assets/images/Acer12.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"32"
          },
          {
            "id": "AC-AS5-R6NA",
            "model": "Laptop Gaming Acer Nitro V ANV16 41 R6NA",
            "price": "29.890.000",
            "status": "hien",
            "image": "../assets/images/Acer13.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"12"
          },
          {
            "id": "AC-AS5-R36Y",
            "model": "Laptop Gaming Acer Nitro V ANV16 41 R36Y",
            "price": "27.390.000",
            "status": "hien",
            "image": "../assets/images/Acer14.png",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"38"
          },
          {
            "id": "AC-AS5-R7EN",
            "model": "Laptop Gaming Acer Nitro V ANV16 41 R7EN",
            "price": "23.990.000",
            "status": "hien",
            "image": "../assets/images/Acer15.jpg",
            "description": "CPU: Intel Core i5-1335U | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: Intel Iris Xe Graphics",
            "qty":"7"
          },
          {
            "id": "AS-TUF-RL151W",
            "model": "Laptop Gaming Asus TUF F16 FX607VJB-RL151W",
            "price": "21.990.000",
            "status": "hien",
            "image": "../assets/images/Asus1.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"3"
          },
          {
            "id": "AS-TUF-SA193W",
            "model": "Laptop Gaming Asus ROG Strix SCAR 18 G835LW-SA193W",
            "price": "79.890.000",
            "status": "hien",
            "image": "../assets/images/Asus2.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"33"
          },
          {
            "id": "AS-TUF-RP216W",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216W",
            "price": "24.190.000",
            "status": "hien",
            "image": "../assets/images/Asus3.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"40"
          },
          // Lỗi ID trùng lặp, cần sửa (Thêm hậu tố để đảm bảo duy nhất trong code này)
          {
            "id": "AS-VVB15-RP216Q-1", 
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216Q",
            "price": "15.444.000",
            "status": "hien",
            "image": "../assets/images/Asus1.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"10"
          },
          {
            "id": "AS-VVB15-i7-2", 
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216E",
            "price": "24.000.000",
            "status": "hien",
            "image": "../assets/images/Asus2.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-VVB15-i7-3", 
            "model": "Laptop Gaming Asus IA V16 V3607VU-RP216W",
            "price": "23.190.000",
            "status": "hien",
            "image": "../assets/images/Asus3.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-VVB15-i7-4", 
            "model": "Laptop Gaming Asus AO V16 V3607VU-RP216W",
            "price": "22.190.000",
            "status": "hien",
            "image": "../assets/images/Asus1.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-i7-5",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP226W",
            "price": "21.190.000",
            "status": "hien",
            "image": "../assets/images/Asus2.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AP-RP216W-6",
            "model": "Laptop Gaming Asus AP V16 V3607VU-RP216W",
            "price": "20.190.000",
            "status": "hien",
            "image": "../assets/images/Asus3.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-RP216W-7",
            "model": "Laptop Gaming Asus AI V10 V3607VU-RP216W",
            "price": "19.190.000",
            "status": "hien",
            "image": "../assets/images/Asus1.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-RP216W-8",
            "model": "Laptop Gaming Asus AI V16 V3607VP-RP216W",
            "price": "29.190.000",
            "status": "hien",
            "image": "../assets/images/Asus2.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-RP216C-9",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216C",
            "price": "28.190.000",
            "status": "hien",
            "image": "../assets/images/Asus3.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"60"
          },
          {
            "id": "AS-AI-RP216R-10",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216R",
            "price": "30.190.000",
            "status": "hien",
            "image": "../assets/images/Asus1.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-RP216A-11",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216A",
            "price": "31.190.000",
            "status": "hien",
            "image": "../assets/images/Asus2.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "AS-AI-RP216D-12",
            "model": "Laptop Gaming Asus AI V16 V3607VU-RP216D",
            "price": "17.190.000",
            "status": "hien",
            "image": "../assets/images/Asus3.png",
            "description": "CPU: Intel Core i7-12700H | RAM: 8GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX 4050",
            "qty":"30"
          },
          {
            "id": "HP-VT-AZ0C6PA-1",
            "model": "Laptop Gaming HP Victus 16-s1141AX AZ0C6PA",
            "price": "27.990.000",
            "status": "hien",
            "image": "../assets/images/HP1.jpg",
            "description": "CPU: Intel Core i7 (Thế hệ mới) | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 30/40)",
            "qty":"30"
          },
          {
            "id": "HP-VT-AZ0D1PA-2",
            "model": "Laptop Gaming HP Victus 16-s1146AX AZ0D1PA",
            "price": "24.990.000",
            "status": "hien",
            "image": "../assets/images/HP2.jpg",
            "description": "CPU: Intel Core i7 (Thế hệ mới) | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 30/40)",
            "qty":"30"
          },
          {
            "id": "HP-VT-AZ0C6PA-3",
            "model": "Laptop Gaming HP Victus 16-s1041AX AZ0C6PA",
            "price": "28.990.000",
            "status": "hien",
            "image": "../assets/images/HP1.jpg",
            "description": "CPU: Intel Core i7 (Thế hệ mới) | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 30/40)",
            "qty":"20"
          },
          {
            "id": "HP-VT-AZ0D1PA-4",
            "model": "Laptop Gaming HP Victus 16-s1156AX AZ0D1PA",
            "price": "25.990.000",
            "status": "hien",
            "image": "../assets/images/HP2.jpg",
            "description": "CPU: Intel Core i7 (Thế hệ mới) | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 30/40)",
            "qty":"30"
          },
          {
            "id": "HP-VT-5",
            "model": "Laptop Gaming HP Victus 16-s141AX AZ0C6PA",
            "price": "29.990.000",
            "status": "hien",
            "image": "../assets/images/HP1.jpg",
            "description": "CPU: Intel Core i7 (Thế hệ mới) | RAM: 16GB DDR4 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 30/40)",
            "qty":"30"
          },
          {
            "id": "LE-VT-1",
            "model": "Laptop Gaming Lenovo LOQ Essential 15IRX11 83SC003TVN",
            "price": "30.490.000",
            "status": "hien",
            "image": "../assets/images/Lenovo1.png",
            "description": "CPU: Intel Core i5/i7 (Thế hệ mới) | RAM: 16GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 40)",
            "qty":"302"
          },
          {
            "id": "LE-VT-2",
            "model": "Laptop Gaming Lenovo LOQ Essential 14IRX11 83SC003RVN",
            "price": "26.990.000",
            "status": "hien",
            "image": "../assets/images/Lenovo2.png",
            "description": "CPU: Intel Core i5/i7 (Thế hệ mới) | RAM: 16GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 40)",
            "qty":"10"
          },
          {
            "id": "LE-VT-3",
            "model": "Laptop Gaming Lenovo LOQ Essential 15IRX12 83SC003TVN",
            "price": "30.999.000",
            "status": "hien",
            "image": "../assets/images/Lenovo1.png",
            "description": "CPU: Intel Core i5/i7 (Thế hệ mới) | RAM: 16GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 40)",
            "qty":"0"
          },
          {
            "id": "LE-VT-4",
            "model": "Laptop Gaming Lenovo LOQ Essential 13IRX11 83SC003RVN",
            "price": "28.990.000",
            "status": "hien",
            "image": "../assets/images/Lenovo2.png",
            "description": "CPU: Intel Core i5/i7 (Thế hệ mới) | RAM: 16GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 40)",
            "qty":"20"
          },
          {
            "id": "LE-VT-5",
            "model": "Laptop Gaming Lenovo LOQ Essential 15IRX10 83SC003TVN",
            "price": "30.000.000",
            "status": "hien",
            "image": "../assets/images/Lenovo1.png",
            "description": "CPU: Intel Core i5/i7 (Thế hệ mới) | RAM: 16GB DDR5 | Ổ cứng: 512GB SSD | VGA: NVIDIA GeForce RTX (Series 40)",
            "qty":"40"
          },
          {
            "id": "DELL-XPS-i9-1",
            "model": "Dell Latitude 3420 Laptop",
            "price": "9.000.560",
            "status": "hien",
            "image": "../assets/images/Dell1.webp",
            "description": "CPU: Intel Core i9-13900H | RAM: 32GB DDR5 | Ổ cứng: 1TB SSD | VGA: NVIDIA GeForce RTX 4070",
            "qty":"32"
          },
          {
            "id": "DELL-XPS-i9-2",
            "model": "Dell Latitude 3419 Laptop",
            "price": "9.500.560",
            "status": "hien",
            "image": "../assets/images/Dell1.webp",
            "description": "CPU: Intel Core i9-13900H | RAM: 32GB DDR5 | Ổ cứng: 1TB SSD | VGA: NVIDIA GeForce RTX 4070",
            "qty":"30"
          },
          {
            "id": "DELL-XPS-i9-3",
            "model": "Dell Latitude 3418 Laptop",
            "price": "10.000.560",
            "status": "hien",
            "image": "../assets/images/Dell1.webp",
            "description": "CPU: Intel Core i9-13900H | RAM: 32GB DDR5 | Ổ cứng: 1TB SSD | VGA: NVIDIA GeForce RTX 4070",
            "qty":"30"
          },
          {
            "id": "DELL-XPS-i9-4",
            "model": "Dell Latitude 3417 Laptop",
            "price": "11.000.560",
            "status": "hien",
            "image": "../assets/images/Dell1.webp",
            "description": "CPU: Intel Core i9-13900H | RAM: 32GB DDR5 | Ổ cứng: 1TB SSD | VGA: NVIDIA GeForce RTX 4070",
            "qty":"30"
          },
          {
            "id": "DELL-XPS-i9-5",
            "model": "Dell Latitude 3416 Laptop",
            "price": "12.000.560",
            "status": "hien",
            "image": "../assets/images/Dell1.webp",
            "description": "CPU: Intel Core i9-13900H | RAM: 32GB DDR5 | Ổ cứng: 1TB SSD | VGA: NVIDIA GeForce RTX 4070",
            "qty":"30"
          }
        ]
      },
      {
        "name": "de-tan-nhiet",
        "status": "active",
        "de-tan-nhiet": [
          {
            "id": "de-tan-nhiet-1",
            "model": "Đế tản nhiệt Cooler Master Ergostand Air",
            "price": "690.000",
            "status": "hien",
            "image": "../assets/images/Dtn1.jpg",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          },
          {
            "id": "de-tan-nhiet-2",
            "model": "Đế tản nhiệt Cooler Master NOTEPAL CMC2",
            "price": "100.000",
            "status": "hien",
            "image": "../assets/images/Dtn2.png",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          },
          {
            "id": "de-tan-nhiet-3",
            "model": "Đế tản nhiệt Cooler Master Ergostand Air",
            "price": "590.000",
            "status": "hien",
            "image": "../assets/images/Dtn1.jpg",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          },
          {
            "id": "de-tan-nhiet-4",
            "model": "Đế tản nhiệt Cooler Master NOTEPAL CMC3",
            "price": "200.000",
            "status": "hien",
            "image": "../assets/images/Dtn2.png",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          },
          {
            "id": "de-tan-nhiet-5",
            "model": "Đế tản nhiệt Cooler Master Ergostand Air",
            "price": "790.000",
            "status": "hien",
            "image": "../assets/images/Dtn1.jpg",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          },
          {
            "id": "de-tan-nhiet-6",
            "model": "Đế tản nhiệt Cooler Master NOTEPAL CMC4",
            "price": "300.000",
            "status": "hien",
            "image": "../assets/images/Dtn2.png",
            "description": "Chất liệu: Nhôm/Nhựa cao cấp | Tính năng: Tản nhiệt hiệu quả, điều chỉnh độ cao | Tương thích: Laptop 14-17 inch",
            "qty":"30"
          }
        ]
      },
      {
        "name": "tai-nghe",
        "status": "active",
        "tai-nghe": [
          {
            "id": "tai-nghe-1",
            "model": "Tai nghe Gaming Logitech G335",
            "price": "1.250.000",
            "status": "hien",
            "image": "../assets/images/Ear1.jpg",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"30"
          },
          {
            "id": "tai-nghe-2",
            "model": "Tai nghe gaming Rapoo VH520C",
            "price": "420.000",
            "status": "hien",
            "image": "../assets/images/Ear2.png",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"30"
          },
          {
            "id": "tai-nghe-3",
            "model": "Tai nghe gaming Rapoo VH650 (USB, 7.2 Led RGB)",
            "price": "350.000",
            "status": "hien",
            "image": "../assets/images/Ear3.jpg",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"30"
          },
          {
            "id": "tai-nghe-4",
            "model": "Tai nghe Gaming Logitech G333",
            "price": "1.550.000",
            "status": "hien",
            "image": "../assets/images/Ear1.jpg",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"0"
          },
          {
            "id": "tai-nghe-5",
            "model": "Tai nghe gaming Rapoo VH520D",
            "price": "450.000",
            "status": "hien",
            "image": "../assets/images/Ear2.png",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"0"
          },
          {
            "id": "tai-nghe-6",
            "model": "Tai nghe gaming Rapoo VH650 (USB, 7.1 Led RGB)",
            "price": "850.000",
            "status": "hien",
            "image": "../assets/images/Ear3.jpg",
            "description": "Kiểu kết nối: USB/3.5mm | Tính năng: Âm thanh vòm 7.1, mic khử tiếng ồn | Dành cho: Gaming/Làm việc",
            "qty":"30"
          }
        ]
      },
      {
        "name": "chuot",
        "status": "active",
        "chuot": [
          {
            "id": "chuot-1",
            "model": "Chuột Razer Cobra - Zenless Zone One Edition",
            "price": "1.369.000",
            "status": "hien",
            "image": "../assets/images/Mouse1.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          },
          {
            "id": "chuot-2",
            "model": "Chuột Logitech G501 Hero RGB",
            "price": "9.600.000",
            "status": "hien",
            "image": "../assets/images/Mouse2.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          },
          {
            "id": "chuot-3",
            "model": "Chuột quang USB Logitech B100",
            "price": "79.000",
            "status": "hien",
            "image": "../assets/images/Mouse3.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          },
          {
            "id": "chuot-4",
            "model": "Chuột Razer Cobra - Zenless Zone Zero Edition",
            "price": "1.100.000",
            "status": "hien",
            "image": "../assets/images/mouse1.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          },
          {
            "id": "chuot-5",
            "model": "Chuột Logitech G502 Hero RGB",
            "price": "1.000.000",
            "status": "hien",
            "image": "../assets/images/Mouse2.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          },
          {
            "id": "chuot-6",
            "model": "Chuột quang USB Logitech B101",
            "price": "100.000",
            "status": "hien",
            "image": "../assets/images/Mouse3.jpg",
            "description": "Loại: Quang/Laser | DPI: 800 - 16000 | Kết nối: Có dây/Không dây | Phù hợp: Gaming/Văn phòng",
            "qty":"30"
          }
        ]
      },
      {
        "name": "balo",
        "status": "active",
        "balo": [
          // Sửa ID để đảm bảo duy nhất trong nhóm
          {
            "id": "DELL-BP-GAMING-1",
            "model": "Balo Dell Gaming",
            "price": "900.000",
            "status": "hien",
            "image": "../assets/images/Balo2.png",
            "description": "Loại sản phẩm: Balo | Kích thước: 17 inch | Chất liệu: Vải chống mài mòn",
            "qty":"0"
          },
          {
            "id": "BA-BALO-2",
            "model": "Balo Predator SUV",
            "price": "300.000",
            "status": "hien",
            "image": "../assets/images/Balo1.png",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"30"
          },
          {
            "id": "BA-BALO-3",
            "model": "Balo Predator Utility",
            "price": "990.000",
            "status": "hien",
            "image": "../assets/images/Balo2.png",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"30"
          },
          {
            "id": "BA-BALO-4",
            "model": "Balo ROG Archer BP1505",
            "price": "2.490.000",
            "status": "hien",
            "image": "../assets/images/Balo3.jpg",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"30"
          },
          {
            "id": "BA-BALO-5",
            "model": "Balo ROG Archer BP2702",
            "price": "5.490.000",
            "status": "an",
            "image": "../assets/images/Balo4.jpg",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"1"
          },
          {
            "id": "BA-BALO-6",
            "model": "Balo ROG Archer Weekender BP2703",
            "price": "4.990.000",
            "status": "an",
            "image": "../assets/images/Balo5.jpg",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"30"
          },
          {
            "id": "BA-BALO-7",
            "model": "Balo ROG Archer Weekender BP2703",
            "price": "5.990.000",
            "status": "hien",
            "image": "../assets/images/Balo1.png",
            "description": "Chất liệu: Bền, chống nước, chống va đập | Tương thích: Laptop 15.6 - 17 inch | Thiết kế: Đa ngăn, chuyên dụng cho Gaming",
            "qty":"30"
          }
        ]
      },
      { 
        "name": "ban-phim",
        "status": "active",
        "ban-phim": [
          {
            "id": "ban-phim-1",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V3 Dark Night",
            "price": "3.150.000",
            "status": "hien",
            "image": "../assets/images/BP1.png",
            "categoryName": "Bàn phím",
            "description": "Số phím: 87 phím | Cổng kết nối: USB | Có dây: Không | Khoảng cách kết nối: 2m | Đèn LED: Không",
            "qty":"1"
          },
          {
            "id": "ban-phim-2",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V3 Horizon Blue",
            "price": "3.050.000",
            "status": "hien",
            "image": "../assets/images/BP2.jpg",
            "categoryName": "Bàn phím",
            "description": "Số phím: 108 phím | Cổng kết nối: USB | Có dây: Có | Khoảng cách kết nối: 15m | Đèn LED: Có",
            "qty":"0"
          },
          {
            "id": "ban-phim-3",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V3 Lilac Purple",
            "price": "3.150.000",
            "status": "hien",
            "image": "../assets/images/BP3.png",
            "categoryName": "Bàn phím",
            "description": "Số phím: 61 phím | Cổng kết nối: Bluetooth | Có dây: Có | Khoảng cách kết nối: 1.8m | Đèn LED: Không",
            "qty":"30"
          },
          {
            "id": "ban-phim-4",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V4 Dark Night",
            "price": "3.550.000",
            "status": "hien",
            "image": "../assets/images/BP1.png",
            "categoryName": "Bàn phím",
            "description": "Số phím: 104 phím | Cổng kết nối: Bluetooth | Có dây: Có | Khoảng cách kết nối: 2m | Đèn LED: Có",
            "qty":"30"
          },
          {
            "id": "ban-phim-5",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V5 Horizon Blue",
            "price": "4.050.000",
            "status": "hien",
            "image": "../assets/images/BP2.jpg",
            "categoryName": "Bàn phím",
            "description": "Số phím: 61 phím | Cổng kết nối: Bluetooth | Có dây: Không | Khoảng cách kết nối: 2m | Đèn LED: Có",
            "qty":"11"
          },
          {
            "id": "ban-phim-6",
            "model": "Bàn phím Akko MonsGeek M1W HE-SP V5 Lilac Purple",
            "price": "3.650.000",
            "status": "hien",
            "image": "../assets/images/BP3.png",
            "categoryName": "Bàn phím",
            "description": "Số phím: 61 phím | Cổng kết nối: USB + Bluetooth | Có dây: Không | Khoảng cách kết nối: 1.8m | Đèn LED: Có",
            "qty":"30"
          }
        ]
      }
    ]
  }
};

// ========== HÀM CHUẨN HÓA DỮ LIỆU ==========
function normalizeData(data) {
    if (!data || !data.product || !data.product.brand) return [];

    let result = [];
    data.product.brand.forEach(brandGroup => {
        const groupName = brandGroup.name; 
        const subProducts = brandGroup[groupName];
        
        if (Array.isArray(subProducts)) {
            subProducts.forEach(product => {
                
                const priceValue = parseInt(String(product.price).replace(/\./g, '').replace(/\.0+$/, ''), 10);
                
                let productCategory = groupName === 'laptop' ? 'laptop' : 'phukien';
                let productType = '';
                
                if (productCategory === 'laptop') {
                    // Xác định type/brand laptop từ ID prefix
                    const idPrefix = product.id.substring(0, 2);
                    if (idPrefix === 'AC') productType = 'Acer';
                    else if (idPrefix === 'AS') productType = 'Asus';
                    else if (idPrefix === 'HP') productType = 'HP';
                    else if (idPrefix === 'LE') productType = 'Lenovo';
                    else if (idPrefix === 'DE') productType = 'Dell';
                    else productType = 'Khac';
                } else {
                    
                    // Đối với phụ kiện/balo, type chính là tên nhóm/id chính
                    // Ví dụ: de-tan-nhiet-1 -> de-tan-nhiet
                    if (groupName === 'balo') {
                        productType = 'balo';
                    } else if (groupName === 'de-tan-nhiet') {
                        productType = 'de-tan-nhiet';
                    } else if (groupName === 'tai-nghe') {
                        productType = 'tai-nghe';
                    } else if (groupName === 'ban-phim') {
                        productType = 'ban-phim';
                    } else if (groupName === 'chuot') {
                        productType = 'chuot';
                    } else {
                        productType = product.id.split('-')[0];
                }}
                
                // Sử dụng ID + Model để tạo key duy nhất (Định dạng được yêu cầu)
                const id = `${product.id}-${product.model.replace(/\s/g, '_')}`;
                
                result.push({
                    ...product,
                    "id": product.id, // ID duy nhất cho frontend
                    "model": product.model, // Dùng 'name' để overwrite 'model'
                    "image": product.image, 
                    "description": product.description, 
                    "status": product.status,                    
                    "qty":product.qty,
                    //cac gia tri dung cho user
                    priceValue: priceValue, // Giá trị số đã được parse
                    category: productCategory,
                    type: productType,
                    
                    originalProductId: product.id  
                });
            });
        }
    });
    return result;
}

// ========== HÀM LOCAL STORAGE ==========
function getLocalProducts() {
    try {
        const data = localStorage.getItem("laptopProducts");
        if (data) {
            const parsedData = JSON.parse(data);
            if (Array.isArray(parsedData) && parsedData.length > 0) {
                // Kiểm tra nếu dữ liệu đã được chuẩn hóa
                if (parsedData[0].priceValue !== undefined && parsedData[0].category !== undefined) {
                    return parsedData;
                }
            }
        }
        
        const productsArray = normalizeData(window.globalJsonData);
        saveLocalProducts(productsArray);
        return productsArray;

    } catch (error) {
        console.error("Lỗi khi lấy dữ liệu sản phẩm, chuẩn hóa lại:", error);
        const productsArray = normalizeData(window.globalJsonData);
        saveLocalProducts(productsArray);
        return productsArray;
    }
}

function saveLocalProducts(data) {
    // Chỉ lưu mảng sản phẩm phẳng đã được chuẩn hóa
    localStorage.setItem("laptopProducts", JSON.stringify(data));
}

// ========== HỆ THỐNG PHÂN TRANG ==========
const PER_PAGE = 15;
let currentLaptopPage = 1;
let currentAccessoryPage = 1;
let currentLaptopProducts = [];
let currentAccessoryProducts = [];
// Khởi tạo allProducts sau khi normalize
let allProducts = getLocalProducts();

// ========== HÀM TẠO THẺ SẢN PHẨM ==========
function createProductCard(product) {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
        <img src="${product.image}" alt="${product.model}" >
        <h3>${shortenProductName(product.model, 45)}</h3>
        <p class="price">${formatPrice(product.priceValue)}</p>
        <button class="buy-now-btn" data-id="${product.id}">
            Mua sắm ngay
        </button>
    `;
    
    card.addEventListener('click', function(e) {
        // KHÔNG xử lý nếu click vào nút "Mua sắm ngay"
        if (e.target.closest('.buy-now-btn')) {
            return;
        }
        
        if (typeof window.showProductDetail === 'function') {
            window.showProductDetail(product.id);
        }
    });

    // GỌI HÀM MUA NGAY
    const buyNowBtn = card.querySelector('.buy-now-btn');
    buyNowBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const productId = product.id;
        buyNowProduct(productId);
    });
    
    return card;
}

// ========== HÀM MUA NGAY SẢN PHẨM ==========
function buyNowProduct(productId) {
    // Tìm sản phẩm
    const productsList = window.productsAPI ? window.productsAPI.getAllProducts() : allProducts;
    const product = productsList.find(p => p.id === productId);
    
    if (!product) {
        console.error(`Không tìm thấy sản phẩm với ID: ${productId}`);
        return;
    }

    // Kiểm tra đăng nhập
    const isLoggedIn = localStorage.getItem("currentUser") !== null;
    if (!isLoggedIn) {
        alert("Vui lòng đăng nhập để mua hàng!");
        document.getElementById("popupLogin").classList.remove("hidden");
        return;
    }

    // LƯU GIỎ HÀNG GỐC TRƯỚC KHI THAY ĐỔI
    window.originalCartData = window.cartData ? [...window.cartData] : [];
    
    // Tạo giỏ hàng tạm thời chỉ với sản phẩm này
    const tempCartItem = {
        id: productId,
        name: product.model,
        price: product.priceValue,
        image: product.image,
        quantity: 1,
        checked: true
    };

    // Đặt giỏ hàng tạm thời
    window.tempCartForBuyNow = [tempCartItem];
    window.cartData = window.tempCartForBuyNow;
    
    // Mở checkout modal
    if (typeof window.openCheckoutModal === 'function') {
        window.openCheckoutModal();
    } else {
        alert("Tính năng thanh toán đang được cập nhật!");
        // Nếu không mở được modal, khôi phục giỏ hàng ngay
        window.cartData = window.originalCartData;
    }
}

// Hàm cập nhật số lượng giỏ hàng
function updateCartCounter() {
    const cartCounter = document.querySelector('.cart-count');
    if (cartCounter && window.cartData) {
      // Cần ensure window.cartData đã được tải từ cart.js
        if (typeof window.getCartData === 'function') {
             window.cartData = window.getCartData();
        }
        const totalItems = window.cartData.reduce((total, item) => total + item.quantity, 0);
        cartCounter.textContent = totalItems;
        cartCounter.style.display = totalItems > 0 ? 'flex' : 'none';
    }
}

// Hàm định dạng giá tiền
function formatPrice(price) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(price);
}

// ========== HÀM RÚT GỌN TÊN ==========
function shortenProductName(name, maxLength = 45) {
    if (name.length <= maxLength) {
        return name;
    }
    return name.substring(0, maxLength) + '...';
}

// Render sản phẩm với phân trang
function renderProducts(productsList, page = 1, gridId = "product-grid") {
    const grid = document.getElementById(gridId);
    if (!grid) {
        console.error(`Không tìm thấy grid với id: ${gridId}`);
        return;
    }
    
    // 1. LỌC DANH SÁCH SẢN PHẨM CHỈ LẤY NHỮNG SẢN PHẨM SẼ ĐƯỢC HIỂN THỊ
    const visibleProducts = productsList.filter(product => {
        const productStatus = product.status || 'an';
        const categoryActiveStatus = product.categoryStatus || 'active'; 
        
        // CHỈ GIỮ LẠI SẢN PHẨM CÓ status='hien' VÀ categoryStatus='active'
        return productStatus.toLowerCase() === 'hien' && categoryActiveStatus.toLowerCase() === 'active';
    });
    

    // PHÂN BIỆT LAPTOP VÀ PHỤ KIỆN
    if (gridId === "product-grid") {
        currentLaptopProducts = productsList;
        currentLaptopPage = page;
    } else {
        currentAccessoryProducts = productsList;
        currentAccessoryPage = page;
    }
    
    grid.innerHTML = "";

    // 2. TÍNH TOÁN PHÂN TRANG DỰA TRÊN SỐ LƯỢNG SẢN PHẨM CÓ THỂ HIỂN THỊ (visibleProducts)
    const total = visibleProducts.length; 
    const totalPages = Math.max(1, Math.ceil(total / PER_PAGE));
    
    let currentPage = page;
    if (currentPage < 1) currentPage = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    
    const start = (currentPage - 1) * PER_PAGE;
    const end = start + PER_PAGE;

    // 3. CẮT MẢNG DỰA TRÊN visibleProducts
    const pageProducts = visibleProducts.slice(start, end);
    
    // 4. RENDER: Tất cả sản phẩm trong pageProducts đều đã được lọc
    pageProducts.forEach(product => {
        const productCard = createProductCard(product);
        grid.appendChild(productCard);
    });
    
     // 5. CẬP NHẬT PHÂN TRANG
    // Cập nhật số lượng sản phẩm
    updateProductCount(total, currentPage, gridId);
    
    // Render phân trang
    renderPagination(totalPages, currentPage, gridId);
}

// Cập nhật số lượng sản phẩm
function updateProductCount(total, currentPage, gridId) {
    const countElement = document.getElementById(gridId === "product-grid" ? "productCount" : "accessoryCount");
    if (countElement) {
        const start = (currentPage - 1) * PER_PAGE + 1;
        const end = Math.min(currentPage * PER_PAGE, total);
        countElement.textContent = `Hiển thị ${start}-${end} của ${total} sản phẩm`;
    }
}

// Render phân trang
function renderPagination(totalPages, currentPage, gridId = "product-grid") {
    const paginationId = gridId === "product-grid" ? "pagination" : "accessory-pagination";
    const container = document.getElementById(paginationId);
    if (!container) {
        console.error(`Không tìm thấy container phân trang: ${paginationId}`);
        return;
    }
    
    container.innerHTML = '';
    
    if (totalPages <= 1) return;
    
    console.log(`Render phân trang: trang ${currentPage}/${totalPages} cho ${gridId}`);

    // Nút Previous
    const prevBtn = document.createElement("button");
    prevBtn.innerHTML = "‹";
    prevBtn.className = "pagination-btn";
    prevBtn.disabled = currentPage <= 1;
    prevBtn.addEventListener("click", () => {
        if (currentPage > 1) {
            if (gridId === "product-grid") {
                renderProducts(currentLaptopProducts, currentPage - 1, gridId);
            } else {
                renderProducts(currentAccessoryProducts, currentPage - 1, gridId);
            }
        }
    });
    container.appendChild(prevBtn);
    
    // Các nút trang
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    // Trang đầu
    if (startPage > 1) {
        const firstBtn = document.createElement("button");
        firstBtn.textContent = "1";
        firstBtn.className = "pagination-btn";
        firstBtn.addEventListener("click", () => {
            if (gridId === "product-grid") {
                renderProducts(currentLaptopProducts, 1, gridId);
            } else {
                renderProducts(currentAccessoryProducts, 1, gridId);
            }
            window.scrollTo({ top: 0, behavior: "smooth" });
        });
        container.appendChild(firstBtn);
        
        if (startPage > 2) {
            const dots = document.createElement("span");
            dots.textContent = "...";
            dots.className = "pagination-dots";
            container.appendChild(dots);
        }
    }
    
    // Các trang giữa
    for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.textContent = i;
        pageBtn.className = "pagination-btn";
        if (i === currentPage) {
            pageBtn.classList.add("active");
        }
        pageBtn.addEventListener("click", () => {
            if (gridId === "product-grid") {
                renderProducts(currentLaptopProducts, i, gridId);
            } else {
                renderProducts(currentAccessoryProducts, i, gridId);
            }
        });
        container.appendChild(pageBtn);
    }
    
    // Trang cuối
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const dots = document.createElement("span");
            dots.textContent = "...";
            dots.className = "pagination-dots";
            container.appendChild(dots);
        }
        
        const lastBtn = document.createElement("button");
        lastBtn.textContent = totalPages;
        lastBtn.className = "pagination-btn";
        lastBtn.addEventListener("click", () => {
            if (gridId === "product-grid") {
                renderProducts(currentLaptopProducts, totalPages, gridId);
            } else {
                renderProducts(currentAccessoryProducts, totalPages, gridId);
            }
        });
        container.appendChild(lastBtn);
    }
    
    // Nút Next
    const nextBtn = document.createElement("button");
    nextBtn.innerHTML = "›";
    nextBtn.className = "pagination-btn";
    nextBtn.disabled = currentPage >= totalPages;
    nextBtn.addEventListener("click", () => {
        if (currentPage < totalPages) {
            if (gridId === "product-grid") {
                renderProducts(currentLaptopProducts, currentPage + 1, gridId);
            } else {
                renderProducts(currentAccessoryProducts, currentPage + 1, gridId);
            }
        }
    });
    container.appendChild(nextBtn);
}

// ========== LỌC SẢN PHẨM ==========
function filterLaptopsByBrand(brand) {
    const brandName = brand === "all" ? "all" : brand; 
    const filtered = allProducts.filter(product => 
        product.category === "laptop" && (brandName === "all" || product.type === brandName)
    );
    renderProducts(filtered, 1, "product-grid");
}

function filterAccessoriesByType(type) {
    const typeMap = {
        "Tất cả": "all",
        "Balo": "balo",
        "Đế tản nhiệt": "de-tan-nhiet", 
        "Tai nghe": "tai-nghe",
        "Chuột": "chuot",
        "Bàn phím": "ban-phim", 
        'Phụ kiện khác':'phukienkhac'
    };
    
    // Lấy key đã chuẩn hóa hoặc dùng type nếu không tìm thấy (và chuyển về chữ thường)
    const typeKey = typeMap[type] || type.toLowerCase();
    const filtered = allProducts.filter(product => 
        product.category === "phukien" && (typeKey === "all" || product.type === typeKey)
    );
    renderProducts(filtered, 1, "accessory-grid");
}

// ========== TÌM KIẾM ==========
function searchProducts() {
    const searchInput = document.getElementById("searchInput");
    if (!searchInput) return;
    
    const searchTerm = searchInput.value.trim().toLowerCase();
    
    if (searchTerm === "") {
        // Nếu search rỗng, hiển thị lại tất cả và ẩn dropdown
        resetToHomePageFromProducts();
        hideSearchResults();
    }
    // KHÔNG làm gì khi có search term - để search.js xử lý dropdown
}

// Hàm reset về trang chủ
function resetToHomePageFromProducts() {

    allProducts = getLocalProducts();
    const laptops = allProducts.filter(p => p.category === "laptop");
    const accessories = allProducts.filter(p => p.category === "phukien");
    
    renderProducts(laptops, 1, "product-grid");
    renderProducts(accessories, 1, "accessory-grid");
    
    // Hiện lại tất cả section
    const sliderSection = document.getElementById("slider");
    const suggestionsSection = document.getElementById("suggestions");
    const accessoriesSection = document.getElementById("accessories");
    const productDetailSection = document.getElementById("productDetail");
    const cartDetailSection = document.getElementById("cartDetail");
    const historyPageSection = document.getElementById("historyPage");
    const profile = document.getElementById("profile");
    
    if (sliderSection) sliderSection.style.display = "block";
    if (suggestionsSection) suggestionsSection.style.display = "block";
    if (accessoriesSection) accessoriesSection.style.display = "block";
    if (productDetailSection) productDetailSection.style.display = "none";
    if (cartDetailSection) cartDetail.style.display = "none";
    if (historyPageSection) historyPage.style.display = "none";
    profile.classList.add("hidden");
    
    // Reset tabs về "Tất cả"
    const laptopTabs = document.querySelectorAll("#brandTabs button");
    const accessoryTabs = document.querySelectorAll("#accessories .tabs button");
    
    if (laptopTabs.length > 0) {
        laptopTabs.forEach((tab, index) => {
            if (index === 0) tab.classList.add("active");
            else tab.classList.remove("active");
        });
    }
    
    if (accessoryTabs.length > 0) {
        accessoryTabs.forEach((tab, index) => {
            if (index === 0) tab.classList.add("active");
            else tab.classList.remove("active");
        });
    }
    window.scrollTo({ top: 0, behavior: "smooth" });
}

// ========== KHỞI TẠO ==========
document.addEventListener("DOMContentLoaded", function() {
    let allProducts = getLocalProducts();
    
    // Lọc laptop và phụ kiện
    const laptops = allProducts.filter(p => p.category === "laptop");
    const accessories = allProducts.filter(p => p.category === "phukien");
    
    // Render ban đầu
    renderProducts(laptops, 1, "product-grid");
    renderProducts(accessories, 1, "accessory-grid");
    
    // Gắn sự kiện cho tabs laptop
    const laptopTabs = document.querySelectorAll("#brandTabs button");
    if (laptopTabs.length > 0) {
        laptopTabs.forEach((tab, index) => {
            tab.addEventListener("click", () => {
                laptopTabs.forEach(t => t.classList.remove("active"));
                tab.classList.add("active");
                
                // Sử dụng textContent làm brand
                const brand = index === 0 ? "all" : tab.textContent.trim();
                filterLaptopsByBrand(brand);
            });
        });
    }
    
    // Gắn sự kiện cho tabs phụ kiện
    const accessoryTabs = document.querySelectorAll("#accessories .tabs button");
    if (accessoryTabs.length > 0) {
        accessoryTabs.forEach((tab, index) => {
            tab.addEventListener("click", () => {
                accessoryTabs.forEach(t => t.classList.remove("active"));
                tab.classList.add("active");
                
                const type = index === 0 ? "all" : tab.textContent.trim();
                filterAccessoriesByType(type);
            });
        });
    }
    
    // Gắn sự kiện tìm kiếm - CHỈ reset khi search rỗng
    const searchInput = document.getElementById("searchInput");
    if (searchInput) {
        searchInput.addEventListener("input", function() {
          const searchTerm = this.value.trim();
          if (searchTerm === "") {
            searchProducts(); // Chỉ gọi khi search rỗng
          }
            // Khi có chữ, để search.js xử lý dropdown
          });
    }
    
    // Gắn sự kiện cho menu dropdown
    attachDropdownEvents();
    
    console.log("Khởi tạo trang sản phẩm thành công!");
});

window.addEventListener('storage', function(e) {
    // Kiểm tra xem có phải laptopProducts bị thay đổi không
    if (e.key === 'laptopProducts' && e.newValue !== e.oldValue) {
        console.log('Phát hiện thay đổi dữ liệu sản phẩm từ Admin!');
        
        try {
            // Parse dữ liệu mới
            const updatedProducts = JSON.parse(e.newValue);
            
            if (Array.isArray(updatedProducts) && updatedProducts.length > 0) {
                // Cập nhật allProducts
                window.allProducts = updatedProducts;
                allProducts = updatedProducts;
                
                // Refresh lại giao diện
                if (typeof window.productsAPI !== 'undefined' && 
                    typeof window.productsAPI.refreshData === 'function') {
                    window.productsAPI.refreshData();
                }
                
                console.log('Đã đồng bộ dữ liệu mới:', updatedProducts.length, 'sản phẩm');
            }
        } catch (error) {
            console.error('Lỗi khi đồng bộ dữ liệu:', error);
        }
    }
});

// ========== MENU DROPDOWN EVENTS ==========
// Hàm để search.js có thể truy cập products
window.getSearchProducts = function() {
    return allProducts;
};

// ========== MENU DROPDOWN EVENTS ==========
function attachDropdownEvents() {
    // Laptop brands từ dropdown
    const laptopItems = document.querySelectorAll(".dropdown .col:first-child ul li");
    laptopItems.forEach(item => {
        item.addEventListener("click", () => {
            const brand = item.textContent.trim();
            
            // Active tab tương ứng
            const laptopTabs = document.querySelectorAll("#brandTabs button");
            laptopTabs.forEach(tab => {
                if (tab.textContent.trim() === brand) {
                    tab.classList.add("active");
                    found = true;
                } else {
                    tab.classList.remove("active");
                }
            });
            
            // Lọc sản phẩm
            filterLaptopsByBrand(brand);
            
            // Cuộn đến phần laptop
            const suggestionsSection = document.getElementById("suggestions");
            if (suggestionsSection) {
                suggestionsSection.scrollIntoView({ behavior: "smooth" });
            }
            window.hideSearchResults();
        });
    });
    
    // Phụ kiện từ dropdown
    const accessoryItems = document.querySelectorAll(".dropdown .col:last-child ul li");
    accessoryItems.forEach(item => {
        item.addEventListener("click", () => {
            const type = item.textContent.trim();
            
            // Active tab tương ứng
            const accessoryTabs = document.querySelectorAll("#accessories .tabs button");
            let found = false;
            accessoryTabs.forEach(tab => {
                if (tab.textContent.trim() === type) {
                    tab.classList.add("active");
                    found = true;
                } else {
                    tab.classList.remove("active");
                }
            });
            
            // Nếu không tìm thấy tab, chọn tab "Tất cả"
            if (!found && accessoryTabs[0]) {
                accessoryTabs[0].classList.add("active");
                filterAccessoriesByType("all");
            } else {
                filterAccessoriesByType(type);
            }
            
            // Cuộn đến phần phụ kiện
            const accessoriesSection = document.getElementById("accessories");
            if (accessoriesSection) {
                accessoriesSection.scrollIntoView({ behavior: "smooth" });
            }
            window.hideSearchResults();
        });
    });
}

// Xuất biến để có thể debug từ console
window.productsAPI = {
    getAllProducts: () => allProducts,
    getLaptops: () => allProducts.filter(p => p.category === "laptop"),
    getAccessories: () => allProducts.filter(p => p.category === "phukien"),
    refreshData: () => {
        allProducts = getLocalProducts();
        const laptops = allProducts.filter(p => p.category === "laptop");
        const accessories = allProducts.filter(p => p.category === "phukien");
        renderProducts(laptops, 1, "product-grid");
        renderProducts(accessories, 1, "accessory-grid");
    }
};

// ========== EXPORT CHO SEARCH SYSTEM ==========
// Xuất biến allProducts ra global để search.js có thể truy cập
window.allProducts = allProducts;

// Hàm format price (dùng chung)
window.formatPrice = function(price) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(price);
};

// Hàm ẩn kết quả tìm kiếm
function hideSearchResults() {
    const searchResults = document.getElementById('searchResults');
    if (searchResults) {
        searchResults.classList.remove('active');
    }
}

// Xuất hàm ra global để search.js dùng
window.hideSearchResults = hideSearchResults;
window.resetToHomePageFromProducts = resetToHomePageFromProducts;